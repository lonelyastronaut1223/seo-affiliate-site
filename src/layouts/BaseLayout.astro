---
/**
 * Base Layout - EXACT structure from original index.html
 * Includes all CSS, meta tags, scripts in the same order
 */
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

interface Props {
    title: string;
    description: string;
    canonical?: string;
}

const { title, description, canonical } = Astro.props;
const currentYear = new Date().getFullYear();

// Generate JSON-LD structured data
const jsonLd = JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebPage",
    name: title,
    url: canonical || "https://cameraupick.com",
    description: description,
    inLanguage: "en",
    isPartOf: {
        "@type": "WebSite",
        name: "cameraupick",
        url: "https://cameraupick.com",
        description: "Camera reviews, comparisons, and buying guides",
        publisher: {
            "@type": "Organization",
            name: "cameraupick",
            url: "https://cameraupick.com",
            logo: {
                "@type": "ImageObject",
                url: "https://cameraupick.com/assets/images/logo.webp",
                width: 28,
                height: 28,
            },
            sameAs: [
                "https://youtube.com/@Taylor-hv8bj",
                "https://www.instagram.com/astronaut_taylor",
            ],
        },
    },
    breadcrumb: {
        "@type": "BreadcrumbList",
        itemListElement: [
            {
                "@type": "ListItem",
                position: 1,
                name: "Home",
                item: "https://cameraupick.com",
            },
        ],
    },
});
---

<!doctype html>
<html lang="en" prefix="og: https://ogp.me/ns#">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content={description} />
        <meta name="robots" content="index,follow,max-image-preview:large" />
        <meta name="theme-color" content="#0b1220" />

        <!-- Font preload with optimized loading -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            rel="preload"
            as="style"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
            onload="this.onload=null;this.rel='stylesheet'"
        />
        <noscript>
            <link
                rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
            />
        </noscript>

        <!-- Preload critical resources for LCP -->
        <link
            rel="preload"
            as="image"
            href="/assets/images/guides/main-page-1280.webp"
            type="image/webp"
        />
        <link rel="preload" as="style" href="/assets/css/style.min.css" />

        <!-- CDN preconnect for Anime.js -->
        <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
        <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

        <!-- Favicon / App Icons -->
        <link
            rel="icon"
            type="image/png"
            href="/assets/images/favicon.png?v=2"
        />
        <link rel="apple-touch-icon" href="/assets/images/favicon.png?v=2" />
        <link rel="manifest" href="/site.webmanifest" />

        {canonical && <link rel="canonical" href={canonical} />}

        <!-- Open Graph / Twitter -->
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="cameraupick" />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta
            property="og:image"
            content="https://cameraupick.com/og-image.png"
        />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta
            property="og:image:alt"
            content="cameraupick - Camera Reviews, Comparisons & Buying Guides"
        />
        <meta
            property="og:url"
            content={canonical || "https://cameraupick.com"}
        />

        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta
            name="twitter:image"
            content="https://cameraupick.com/og-image.png"
        />
        <meta
            name="twitter:image:alt"
            content="cameraupick - Camera Reviews, Comparisons & Buying Guides"
        />

        <title>{title}</title>

        <!-- Structured Data (Schema.org JSON-LD) -->
        <script type="application/ld+json" set:html={jsonLd} />

        <!-- CSS - SAME ORDER AS ORIGINAL -->
        <link rel="stylesheet" href="/assets/css/style.min.css" />
        <link rel="stylesheet" href="/assets/css/footer-enhancements.min.css" />
        <link rel="stylesheet" href="/assets/css/loaders.min.css" />
        <link rel="stylesheet" href="/assets/css/mega-menu.min.css" />

        <!-- Google Analytics - Deferred for performance -->
        <link rel="preconnect" href="https://www.googletagmanager.com" />
        <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    </head>

    <body>
        <div class="reading-progress">
            <div class="progress-bar"></div>
        </div>

        <a class="skip-link" href="#main">Skip to content</a>

        <Header />

        <slot />

        <Footer />

        <!-- Scripts - Optimized for performance -->
        <script is:inline src="/assets/js/links.min.js?v=20260120" defer
        ></script>
        <script is:inline src="/assets/js/mega-menu.min.js" defer></script>

        <!-- Main script - deferred and idle-loaded for minimal TBT -->
        <script is:inline>
            // Load main script after page is interactive
            function loadMainScript() {
                var s = document.createElement("script");
                s.src = "/assets/js/script.min.js";
                s.defer = true;
                document.body.appendChild(s);
            }
            if (window.requestIdleCallback) {
                requestIdleCallback(loadMainScript, { timeout: 1000 });
            } else {
                setTimeout(loadMainScript, 100);
            }
        </script>

        <!-- Service Worker Registration & Deferred Analytics -->
        <script is:inline>
            // Service Worker
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then((reg) => console.log("SW registered"))
                        .catch((err) => console.log("SW registration failed"));
                });
            }

            // Deferred Google Analytics - loads after page is interactive
            function loadGA() {
                var s = document.createElement("script");
                s.async = true;
                s.src =
                    "https://www.googletagmanager.com/gtag/js?id=G-DLCVQGNSW4";
                document.head.appendChild(s);

                window.dataLayer = window.dataLayer || [];
                function gtag() {
                    dataLayer.push(arguments);
                }
                gtag("js", new Date());
                gtag("config", "G-DLCVQGNSW4");
            }

            // Load GA after page is fully loaded and idle
            if (window.requestIdleCallback) {
                requestIdleCallback(loadGA);
            } else {
                setTimeout(loadGA, 2000);
            }
        </script>

        <!-- Anime.js Animation Library -->
        <script
            is:inline
            src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"
            defer></script>
        <script is:inline src="/assets/js/animations.min.js" defer></script>
    </body>
</html>
