const affiliateLinks = {
    // Cameras
    "sony-a6700": "https://amzn.to/4sNqGpp",
    "sony-a7c-ii": "https://amzn.to/3Nu7WLt",
    "sony-a7iv": "https://amzn.to/4bGTSYU",
    "sony-zv-e10-ii": "https://amzn.to/4pLUaB2",
    "sony-zv-e10": "https://amzn.to/3ZqPFRG",
    "sony-zv-e1": "https://amzn.to/3NrjH5m",
    "sony-fx3": "https://amzn.to/3LrIllM",
    "fuji-x100vi": "https://amzn.to/3NSMrE1",
    "fuji-x-t50": "https://amzn.to/4r1yz8O",
    "fuji-x-t5": "https://amzn.to/4608U8o",
    "fuji-xt5": "https://amzn.to/4608U8o",
    "fuji-x-s20": "https://amzn.to/4sOOHMB",
    "fuji-xs10": "https://www.amazon.de/Fujifilm-X-S10-Body-Black-FUJIFILM/dp/B08KWGJ9YK?th=1",
    "canon-r50": "https://amzn.to/3LrDJfr",
    "canon-r100": "https://amzn.to/4bDXACz",
    "canon-r8": "https://amzn.to/4pQdxt4",
    "canon-r6ii": "https://amzn.to/3NrHVMN",
    "canon-r6-ii": "https://amzn.to/3NrHVMN",
    "panasonic-s5ii": "https://amzn.to/49wqRhk",
    "panasonic-s5iix": "https://amzn.to/4r7x0qe",
    "lumix-g100d": "https://amzn.to/4pOXNpY",
    "nikon-z8": "https://amzn.to/4qthiFD",
    "om-system-om5": "https://amzn.to/4sQdzUf",
    "dji-pocket-3": "https://amzn.to/4jSSwMT",
    "dji-action-5": "https://amzn.to/4a3tI1h",
    "gopro-13": "https://amzn.to/4pMsdsU",
    "insta360-x4": "https://amzn.to/3NzLzUL",
    "sony-a7-v": "",
    "canon-r6-iii": "",
    // Lenses - Sony
    "sigma-56-14": "https://amzn.to/sigma56",
    "tamron-17-70": "https://amzn.to/tamron1770",
    "sony-35-18": "https://amzn.to/sony35",
    "sony-70-350": "https://amzn.to/sony70350",
    // Lenses - Canon
    "canon-rf-50": "https://amzn.to/canonrf50",
    "canon-rfs-18-150": "https://amzn.to/canonrfs18150",
    "canon-rf-85": "https://amzn.to/canonrf85",
    "canon-rf-24-105": "https://amzn.to/canonrf24105",
    // Lenses - Fujifilm
    "fuji-xf23-f2": "https://amzn.to/fujixf23",
    "fuji-xf56-f12": "https://amzn.to/fujixf56",
    "sigma-18-50-fuji": "https://amzn.to/sigma1850fuji",
    "fuji-xf18-55": "https://amzn.to/fujixf1855",
    // Gear - Tripods
    "peak-travel-tripod": "https://amzn.to/peaktripod",
    "manfrotto-befree": "https://amzn.to/manfrottobefree",
    "ulanzi-mt79": "https://amzn.to/ulanzim79",
    // Gear - Bags
    "peak-everyday-30": "https://amzn.to/peakeveryday",
    "lowepro-protactic": "https://amzn.to/loweproprotactic",
    "wandrd-prvke": "https://amzn.to/wandrdprvke",
    // Gear - SD Cards
    "sandisk-extreme-pro-256": "https://amzn.to/sandiskextremepro",
    "sony-tough-v90": "https://amzn.to/sonytough",
    "sandisk-extreme-256": "https://amzn.to/sandiskextreme"
};

function applyAffiliateLinks() {
    console.log("Applying affiliate links...");
    let updatedCount = 0;
    const isGerman = document.documentElement.lang === 'de';
    const checkPriceText = isGerman ? 'Preis prÃ¼fen' : 'Check Price';

    const updateBtn = (btn, url) => {
        if (btn) {
            btn.href = url;
            btn.target = "_blank";
            btn.rel = "sponsored noopener noreferrer";
        }
    };

    for (const [id, link] of Object.entries(affiliateLinks)) {
        if (!link || link === "#" || link === "") continue;

        // Method 1: Find section by ID and update .btn-buy inside
        const section = document.getElementById(id);
        if (section) {
            const btn = section.querySelector('.btn-buy');
            updateBtn(btn, link);
        }

        // Method 2: Find buttons with data-product attribute
        const dataButtons = document.querySelectorAll(`.btn-buy[data-product="${id}"]`);
        dataButtons.forEach(btn => updateBtn(btn, link));

        // Method 3: Update comparison table links
        const selector = `a[href="#${id}"]`;
        const internalAnchors = document.querySelectorAll(selector);
        internalAnchors.forEach(anchor => {
            const row = anchor.closest('tr');
            if (row) {
                const priceCell = row.querySelector('.price-check');
                if (priceCell) {
                    priceCell.innerHTML = `
                        <a href="${link}" target="_blank" rel="sponsored noopener noreferrer"
                           style="color: #10b981; text-decoration: none; font-weight: 800; display: inline-flex; align-items: center; gap: 4px;">
                            ${checkPriceText} <span style="font-size: 1.2em;">&rarr;</span>
                        </a>
                    `;
                    updatedCount++;
                }
            }
        });
    }

    console.log(`Links applied. Updated ${updatedCount} comparisons/buttons.`);
}

if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", applyAffiliateLinks);
} else {
    applyAffiliateLinks();
}